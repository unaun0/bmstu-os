# –°–µ—Ç–µ–≤—ã–µ —Å–æ–∫–µ—Ç—ã 

–°–µ—Ç–µ–≤—ã–µ —Å–æ–∫–µ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –ø–æ —Å–µ—Ç–∏. –í Linux –æ–Ω–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ <sys/socket.h>. 

## 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–∫–µ—Ç–∞ - `socket()`

```
int sock_fd = socket(AF_INET, SOCK_STREAM, 0);
```

* `AF_INET` ‚Äî —Å–µ–º–µ–π—Å—Ç–≤–æ –∞–¥—Ä–µ—Å–æ–≤ IPv4 (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AF_INET6 –¥–ª—è IPv6).
* `SOCK_STREAM` ‚Äî –ø–æ—Ç–æ–∫–æ–≤—ã–π —Å–æ–∫–µ—Ç (TCP). –ï—Å–ª–∏ –Ω—É–∂–µ–Ω UDP, —Ç–æ SOCK_DGRAM.
* `0` ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è TCP/UDP).

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä (FD) —Å–æ–∫–µ—Ç–∞ –∏–ª–∏ `-1` –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏.

## 2. –ß—Ç–æ —Ç–∞–∫–æ–µ `struct sockaddr_in`?

–≠—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± IP-–∞–¥—Ä–µ—Å–µ (IP-–∞–¥—Ä–µ—Å - 32 –±–∏—Ç–∞), –ø–æ—Ä—Ç–µ (–Ω–æ–º–µ—Ä –ø–æ—Ä—Ç–∞ - 16 –±–∏—Ç ) –∏ –æ —Å–µ–º–µ–π—Å—Ç–≤–µ –∞–¥—Ä–µ—Å–æ–≤ (`AF_INET` - IPv4). 

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã `sin_family`:** `AF_INET6` ‚Äî –¥–ª—è IPv6; `AF_UNIX` ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

**–£–∫–∞–∑–∞–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ (`sin_addr`):** `server_addr.sin_addr.s_addr = INADDR_ANY;`

`INADDR_ANY` (–∑–Ω–∞—á–µ–Ω–∏–µ `0.0.0.0`) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö.

**–£–∫–∞–∑–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞ - `htons(SERVER_PORT)`:** `server_addr.sin_port = htons(SERVER_PORT);`

SERVER_PORT ‚Äî –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä.

üìå `htons()` (*host to network short*) –ø–µ—Ä–µ–≤–æ–¥–∏—Ç 16-–±–∏—Ç–Ω—ã–π –ø–æ—Ä—Ç –≤ —Å–µ—Ç–µ–≤–æ–π –ø–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç–æ–≤ (*big-endian*).

üìå –í–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä–∞–∑–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—è–¥–∫–∏ –±–∞–π—Ç–æ–≤.

–û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö, –∫–∞–∫ `bind()`, `connect()` –∏ `accept()`.

## 3. –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–∫–µ—Ç–∞ –∫ –∞–¥—Ä–µ—Å—É - `bind()` - –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

```
bind(server_sock_fd, (struct sockaddr*)&server_addr, sizeof(server_addr))
```

**–°–µ—Ä–≤–µ—Ä—É –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –Ω–∞ –∫–∞–∫–æ–º IP –∏ –ø–æ—Ä—Ç—É —Å–ª—É—à–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.**

## 4. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π - `listen()` - –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

```
listen(server_sock_fd, SERVER_BACKLOG)
```

* `server_sock_fd` ‚Äî —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å–æ–∫–µ—Ç–∞.
* `SERVER_BACKLOG` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.

**–≠—Ç–æ—Ç –≤—ã–∑–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–æ–∫–µ—Ç –≤ —Ä–µ–∂–∏–º –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.**

## 5. –ü—Ä–∏–Ω—è—Ç–∏–µ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - `accept()` - –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

```
struct sockaddr_in client_addr;
socklen_t client_len = sizeof(client_addr);
int client_sock_fd = accept(server_sock_fd, (struct sockaddr*)&client_addr, &client_len);
```

* `accept()` - –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

* –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä (`client_sock_fd`) –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º.

## 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É - `connect()` - –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

```
struct sockaddr_in server_addr;
memset(&server_addr, 0, sizeof(server_addr));

server_addr.sin_family = AF_INET;
server_addr.sin_port = htons(SERVER_PORT);
inet_pton(AF_INET, SERVER_IP, &server_addr.sin_addr); 

if (connect(sock_fd, (struct sockaddr*)&server_addr, sizeof(server_addr)) == -1) {
    perror("connect");
    close(sock_fd);
    exit(EXIT_FAILURE);
}
```

`inet_pton(AF_INET, SERVER_IP, &server_addr.sin_addr)` ‚Äî –ø–µ—Ä–µ–≤–æ–¥–∏—Ç IP-–∞–¥—Ä–µ—Å –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

–ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `connect()` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.

## 7. –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 7.1. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö - `send()`

```
char message[] = "Hello, Server!";
send(client_sock_fd, message, strlen(message), 0)
```

`send(—Å–æ–∫–µ—Ç, –±—É—Ñ–µ—Ä, —Ä–∞–∑–º–µ—Ä, —Ñ–ª–∞–≥–∏)`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–π—Ç–æ–≤ –∏–ª–∏ `-1` –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏.

### 7.2. –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö - `recv()`

```
char buffer[256];
memset(buffer, 0, sizeof(buffer));
recv(client_sock_fd, buffer, sizeof(buffer), 0)
printf("–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: %s\n", buffer);
```

`recv(—Å–æ–∫–µ—Ç, –±—É—Ñ–µ—Ä, —Ä–∞–∑–º–µ—Ä, —Ñ–ª–∞–≥–∏)`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –∏–ª–∏ `0`, –µ—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ.

## 8. –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–∫–µ—Ç–æ–≤ - `close()`

```
close(client_sock_fd);
close(server_sock_fd);
```

* –°–µ—Ä–≤–µ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç `client_sock_fd` –ø–æ—Å–ª–µ –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º.
* `server_sock_fd` –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞.

–°–µ—Ä–≤–µ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç client_sock_fd –ø–æ—Å–ª–µ –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º.
server_sock_fd –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞.

# üîπ –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

## –î–ª—è —Å–µ—Ä–≤–µ—Ä–∞

* –°–æ–∑–¥–∞–µ—Ç —Å–æ–∫–µ—Ç (`socket`).
* –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –µ–≥–æ –∫ IP/–ø–æ—Ä—Ç—É (`bind`).
* –°–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (`listen`).
* –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –≤—Ö–æ–¥–∏—â–∏–π (`accept`).
* –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (`recv`) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç (`send`).
* –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (`close`).

## –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞

* –°–æ–∑–¥–∞–µ—Ç —Å–æ–∫–µ—Ç (`socket`).
* –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É (`connect`).
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å (`send`).
* –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (`recv`).
* –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (`close`).

## üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ–¥–µ?

C–µ—Ä–≤–µ—Ä –∂–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–æ–∑–¥–∞–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å (–∏–ª–∏ –ø–æ—Ç–æ–∫).

**üí° –í–∞–∂–Ω–æ**: –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –≤–µ—Ä—Å–∏–∏ `fork()` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `pthread_create()` - `detach`, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

